{"ast":null,"code":"\"use strict\"; // Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar ledger_1 = __importDefault(require(\"@daml/ledger\"));\n/**\n * Create a [[LedgerContext]]. One should use this function, instead of the default [[DamlLedger]],\n * where one needs to be able to nest ledger interactions, by different parties or connections, within\n * one React application.\n *\n * @param contextName Used to refer to a context in case of errors.\n */\n\n\nfunction createLedgerContext(contextName) {\n  // NOTE(MH, useEffect dependencies): There are various places in this file\n  // where we need to maintain the dependencies of the `useEffect` hook manually\n  // and there's no tool to help us enfore they are correct. Thus, we need to be\n  // extra careful in these locations. If we add too many dependencies, we will\n  // make unnecessary network requests. If we forget adding some dependencies, we\n  // not make a new network request although they are required to refresh data.\n  if (contextName === void 0) {\n    contextName = \"DamlLedgerContext\";\n  }\n\n  var ledgerContext = react_1.default.createContext(undefined);\n\n  var DamlLedger = function (_a) {\n    var token = _a.token,\n        httpBaseUrl = _a.httpBaseUrl,\n        wsBaseUrl = _a.wsBaseUrl,\n        party = _a.party,\n        children = _a.children;\n\n    var _b = react_1.useState(0),\n        reloadToken = _b[0],\n        setReloadToken = _b[1];\n\n    var ledger = react_1.useMemo(function () {\n      return new ledger_1.default({\n        token: token,\n        httpBaseUrl: httpBaseUrl,\n        wsBaseUrl: wsBaseUrl\n      });\n    }, [token, httpBaseUrl, wsBaseUrl]);\n    var state = react_1.useMemo(function () {\n      return {\n        reloadToken: reloadToken,\n        triggerReload: function () {\n          return setReloadToken(function (x) {\n            return x + 1;\n          });\n        },\n        party: party,\n        ledger: ledger\n      };\n    }, [party, ledger, reloadToken]);\n    return react_1.default.createElement(ledgerContext.Provider, {\n      value: state\n    }, children);\n  };\n\n  var useDamlState = function () {\n    var state = react_1.useContext(ledgerContext);\n\n    if (!state) {\n      throw Error(\"Trying to use \" + contextName + \" before initializing.\");\n    }\n\n    return state;\n  };\n\n  var useParty = function () {\n    var state = useDamlState();\n    return state.party;\n  };\n\n  var useLedger = function () {\n    return useDamlState().ledger;\n  };\n\n  function useQuery(template, queryFactory, queryDeps) {\n    var _this = this;\n\n    var state = useDamlState();\n\n    var _a = react_1.useState({\n      contracts: [],\n      loading: true\n    }),\n        result = _a[0],\n        setResult = _a[1];\n\n    react_1.useEffect(function () {\n      setResult({\n        contracts: [],\n        loading: true\n      });\n      var query = queryFactory ? queryFactory() : undefined;\n\n      var load = function () {\n        return __awaiter(_this, void 0, void 0, function () {\n          var contracts;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4\n                /*yield*/\n                , state.ledger.query(template, query)];\n\n              case 1:\n                contracts = _a.sent();\n                setResult({\n                  contracts: contracts,\n                  loading: false\n                });\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      }; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n      load(); // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n    }, __spreadArrays([state.ledger, state.reloadToken, template], queryDeps !== null && queryDeps !== void 0 ? queryDeps : []));\n    return result;\n  }\n\n  function useFetchByKey(template, keyFactory, keyDeps) {\n    var _this = this;\n\n    var state = useDamlState();\n\n    var _a = react_1.useState({\n      contract: null,\n      loading: true\n    }),\n        result = _a[0],\n        setResult = _a[1];\n\n    react_1.useEffect(function () {\n      var key = keyFactory();\n      setResult({\n        contract: null,\n        loading: true\n      });\n\n      var load = function () {\n        return __awaiter(_this, void 0, void 0, function () {\n          var contract;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4\n                /*yield*/\n                , state.ledger.fetchByKey(template, key)];\n\n              case 1:\n                contract = _a.sent();\n                setResult({\n                  contract: contract,\n                  loading: false\n                });\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      }; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n      load(); // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n    }, __spreadArrays([state.ledger, state.reloadToken, template], keyDeps !== null && keyDeps !== void 0 ? keyDeps : []));\n    return result;\n  }\n\n  function useStreamQuery(template, queryFactory, queryDeps) {\n    var _a = react_1.useState({\n      contracts: [],\n      loading: true\n    }),\n        result = _a[0],\n        setResult = _a[1];\n\n    var state = useDamlState();\n    react_1.useEffect(function () {\n      setResult({\n        contracts: [],\n        loading: true\n      });\n      var query = queryFactory ? queryFactory() : undefined;\n      console.debug(\"mount useStreamQuery(\" + template.templateId + \", ...)\", query);\n      var stream = state.ledger.streamQuery(template, query);\n      stream.on('live', function () {\n        return setResult(function (result) {\n          return __assign(__assign({}, result), {\n            loading: false\n          });\n        });\n      });\n      stream.on('change', function (contracts) {\n        return setResult(function (result) {\n          return __assign(__assign({}, result), {\n            contracts: contracts\n          });\n        });\n      });\n      stream.on('close', function (closeEvent) {\n        console.error('useStreamQuery: web socket closed', closeEvent);\n        setResult(function (result) {\n          return __assign(__assign({}, result), {\n            loading: true\n          });\n        });\n      });\n      return function () {\n        console.debug(\"unmount useStreamQuery(\" + template.templateId + \", ...)\", query);\n        stream.close();\n      }; // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n    }, __spreadArrays([state.ledger, template], queryDeps !== null && queryDeps !== void 0 ? queryDeps : []));\n    return result;\n  }\n\n  function useStreamFetchByKey(template, keyFactory, keyDeps) {\n    var _a = react_1.useState({\n      contract: null,\n      loading: true\n    }),\n        result = _a[0],\n        setResult = _a[1];\n\n    var state = useDamlState();\n    react_1.useEffect(function () {\n      setResult({\n        contract: null,\n        loading: true\n      });\n      var key = keyFactory();\n      console.debug(\"mount useStreamFetchByKey(\" + template.templateId + \", ...)\", key);\n      var stream = state.ledger.streamFetchByKey(template, key);\n      stream.on('change', function (contract) {\n        return setResult(function (result) {\n          return __assign(__assign({}, result), {\n            contract: contract\n          });\n        });\n      });\n      stream.on('close', function (closeEvent) {\n        console.error('useStreamFetchByKey: web socket closed', closeEvent);\n        setResult(function (result) {\n          return __assign(__assign({}, result), {\n            loading: true\n          });\n        });\n      });\n      setResult(function (result) {\n        return __assign(__assign({}, result), {\n          loading: false\n        });\n      });\n      return function () {\n        console.debug(\"unmount useStreamFetchByKey(\" + template.templateId + \", ...)\", key);\n        stream.close();\n      }; // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n    }, __spreadArrays([state.ledger, template], keyDeps));\n    return result;\n  }\n\n  var useReload = function () {\n    var state = useDamlState();\n    return function () {\n      return state.triggerReload();\n    };\n  };\n\n  return {\n    DamlLedger: DamlLedger,\n    useParty: useParty,\n    useLedger: useLedger,\n    useQuery: useQuery,\n    useFetchByKey: useFetchByKey,\n    useStreamQuery: useStreamQuery,\n    useStreamFetchByKey: useStreamFetchByKey,\n    useReload: useReload\n  };\n}\n\nexports.createLedgerContext = createLedgerContext;","map":{"version":3,"sources":["/Data/Learn/DAML/daml.com/create-daml-app/ui/node_modules/@daml/react/createLedgerContext.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","Array","k","a","j","jl","__importStar","mod","__esModule","__importDefault","defineProperty","exports","react_1","require","ledger_1","createLedgerContext","contextName","ledgerContext","default","createContext","undefined","DamlLedger","_a","token","httpBaseUrl","wsBaseUrl","party","children","_b","useState","reloadToken","setReloadToken","ledger","useMemo","state","triggerReload","x","createElement","Provider","useDamlState","useContext","Error","useParty","useLedger","useQuery","template","queryFactory","queryDeps","_this","contracts","loading","setResult","useEffect","query","load","useFetchByKey","keyFactory","keyDeps","contract","key","fetchByKey","useStreamQuery","console","debug","templateId","stream","streamQuery","on","closeEvent","error","close","useStreamFetchByKey","streamFetchByKey","useReload"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n// SPDX-License-Identifier: Apache-2.0\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = __importStar(require(\"react\"));\nvar ledger_1 = __importDefault(require(\"@daml/ledger\"));\n/**\n * Create a [[LedgerContext]]. One should use this function, instead of the default [[DamlLedger]],\n * where one needs to be able to nest ledger interactions, by different parties or connections, within\n * one React application.\n *\n * @param contextName Used to refer to a context in case of errors.\n */\nfunction createLedgerContext(contextName) {\n    // NOTE(MH, useEffect dependencies): There are various places in this file\n    // where we need to maintain the dependencies of the `useEffect` hook manually\n    // and there's no tool to help us enfore they are correct. Thus, we need to be\n    // extra careful in these locations. If we add too many dependencies, we will\n    // make unnecessary network requests. If we forget adding some dependencies, we\n    // not make a new network request although they are required to refresh data.\n    if (contextName === void 0) { contextName = \"DamlLedgerContext\"; }\n    var ledgerContext = react_1.default.createContext(undefined);\n    var DamlLedger = function (_a) {\n        var token = _a.token, httpBaseUrl = _a.httpBaseUrl, wsBaseUrl = _a.wsBaseUrl, party = _a.party, children = _a.children;\n        var _b = react_1.useState(0), reloadToken = _b[0], setReloadToken = _b[1];\n        var ledger = react_1.useMemo(function () { return new ledger_1.default({ token: token, httpBaseUrl: httpBaseUrl, wsBaseUrl: wsBaseUrl }); }, [token, httpBaseUrl, wsBaseUrl]);\n        var state = react_1.useMemo(function () { return ({\n            reloadToken: reloadToken,\n            triggerReload: function () { return setReloadToken(function (x) { return x + 1; }); },\n            party: party,\n            ledger: ledger,\n        }); }, [party, ledger, reloadToken]);\n        return react_1.default.createElement(ledgerContext.Provider, { value: state }, children);\n    };\n    var useDamlState = function () {\n        var state = react_1.useContext(ledgerContext);\n        if (!state) {\n            throw Error(\"Trying to use \" + contextName + \" before initializing.\");\n        }\n        return state;\n    };\n    var useParty = function () {\n        var state = useDamlState();\n        return state.party;\n    };\n    var useLedger = function () {\n        return useDamlState().ledger;\n    };\n    function useQuery(template, queryFactory, queryDeps) {\n        var _this = this;\n        var state = useDamlState();\n        var _a = react_1.useState({ contracts: [], loading: true }), result = _a[0], setResult = _a[1];\n        react_1.useEffect(function () {\n            setResult({ contracts: [], loading: true });\n            var query = queryFactory ? queryFactory() : undefined;\n            var load = function () { return __awaiter(_this, void 0, void 0, function () {\n                var contracts;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, state.ledger.query(template, query)];\n                        case 1:\n                            contracts = _a.sent();\n                            setResult({ contracts: contracts, loading: false });\n                            return [2 /*return*/];\n                    }\n                });\n            }); };\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            load();\n            // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n        }, __spreadArrays([state.ledger, state.reloadToken, template], (queryDeps !== null && queryDeps !== void 0 ? queryDeps : [])));\n        return result;\n    }\n    function useFetchByKey(template, keyFactory, keyDeps) {\n        var _this = this;\n        var state = useDamlState();\n        var _a = react_1.useState({ contract: null, loading: true }), result = _a[0], setResult = _a[1];\n        react_1.useEffect(function () {\n            var key = keyFactory();\n            setResult({ contract: null, loading: true });\n            var load = function () { return __awaiter(_this, void 0, void 0, function () {\n                var contract;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, state.ledger.fetchByKey(template, key)];\n                        case 1:\n                            contract = _a.sent();\n                            setResult({ contract: contract, loading: false });\n                            return [2 /*return*/];\n                    }\n                });\n            }); };\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            load();\n            // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n        }, __spreadArrays([state.ledger, state.reloadToken, template], (keyDeps !== null && keyDeps !== void 0 ? keyDeps : [])));\n        return result;\n    }\n    function useStreamQuery(template, queryFactory, queryDeps) {\n        var _a = react_1.useState({ contracts: [], loading: true }), result = _a[0], setResult = _a[1];\n        var state = useDamlState();\n        react_1.useEffect(function () {\n            setResult({ contracts: [], loading: true });\n            var query = queryFactory ? queryFactory() : undefined;\n            console.debug(\"mount useStreamQuery(\" + template.templateId + \", ...)\", query);\n            var stream = state.ledger.streamQuery(template, query);\n            stream.on('live', function () { return setResult(function (result) { return (__assign(__assign({}, result), { loading: false })); }); });\n            stream.on('change', function (contracts) { return setResult(function (result) { return (__assign(__assign({}, result), { contracts: contracts })); }); });\n            stream.on('close', function (closeEvent) {\n                console.error('useStreamQuery: web socket closed', closeEvent);\n                setResult(function (result) { return (__assign(__assign({}, result), { loading: true })); });\n            });\n            return function () {\n                console.debug(\"unmount useStreamQuery(\" + template.templateId + \", ...)\", query);\n                stream.close();\n            };\n            // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n        }, __spreadArrays([state.ledger, template], (queryDeps !== null && queryDeps !== void 0 ? queryDeps : [])));\n        return result;\n    }\n    function useStreamFetchByKey(template, keyFactory, keyDeps) {\n        var _a = react_1.useState({ contract: null, loading: true }), result = _a[0], setResult = _a[1];\n        var state = useDamlState();\n        react_1.useEffect(function () {\n            setResult({ contract: null, loading: true });\n            var key = keyFactory();\n            console.debug(\"mount useStreamFetchByKey(\" + template.templateId + \", ...)\", key);\n            var stream = state.ledger.streamFetchByKey(template, key);\n            stream.on('change', function (contract) { return setResult(function (result) { return (__assign(__assign({}, result), { contract: contract })); }); });\n            stream.on('close', function (closeEvent) {\n                console.error('useStreamFetchByKey: web socket closed', closeEvent);\n                setResult(function (result) { return (__assign(__assign({}, result), { loading: true })); });\n            });\n            setResult(function (result) { return (__assign(__assign({}, result), { loading: false })); });\n            return function () {\n                console.debug(\"unmount useStreamFetchByKey(\" + template.templateId + \", ...)\", key);\n                stream.close();\n            };\n            // NOTE(MH): See note at the top of the file regarding \"useEffect dependencies\".\n        }, __spreadArrays([state.ledger, template], keyDeps));\n        return result;\n    }\n    var useReload = function () {\n        var state = useDamlState();\n        return function () { return state.triggerReload(); };\n    };\n    return { DamlLedger: DamlLedger, useParty: useParty, useLedger: useLedger, useQuery: useQuery, useFetchByKey: useFetchByKey, useStreamQuery: useStreamQuery, useStreamFetchByKey: useStreamFetchByKey, useReload: useReload };\n}\nexports.createLedgerContext = createLedgerContext;\n//# sourceMappingURL=createLedgerContext.js.map"]},"metadata":{},"sourceType":"script"}